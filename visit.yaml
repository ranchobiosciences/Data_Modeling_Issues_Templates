$schema: "https://monarch.web-dev.bms.com/api/schemaref/_schema_validator#"

id: "https://monarch.web-dev.bms.com/api/visit/schema"
title: Visit
title_submitter: Submitter
identifierPrefix: V
type: object
nodeTerms: null
namespace: https://datacommons.web.bms.com/
category: administrative
description: >
  As part of a longitudinal experiment or clinical trial, a subject can have a visit, during which they may undergo 
  a treatment or have a sample taken from them.
additionalProperties: false
validators: null

uiSettings:
  icon: event
  iconStyle: material-icons-outlined
  color: rgb(255, 236, 205)
  uiPath: /datasetcatalog/visit
  plural: Visits
  globalSearchSettings:
    searchFields:
      - visit_label
      - identifier
      - submitter_id
    displayFields:
      - visit_label
      - identifier
      - id
  displayField: visit_label
  displaySubField: identifier # Used for tag section in flex view
  defaultSortField: visit_label
  primaryPersonField: created_by # for email template
  editValidationUserFields:
    - created_by
  nodeIdentifier: id
  #abacSchemaName: _abac_visit
  createForm:
    maxRows: 11
    maxCols: 2
    buttonLabel: Create Visit
  expandFilterOptionsByDefault: true
  dataFilterField:
    visit_date:
      label: Visit Date
      tooltip: true
    visit_timepoint:
      label: Visit Timepoint
      tooltip: true
    identifier:
      label: Identifier
      view: dynamic
      tooltip: true
      optionsPromiseLimit: 100
  tableField:
    identifier: Visit ID
    visit_label: Visit Label
    visit_date: Visit Date
    visit_timepoint: Visit Timepoint
  searchField:
    - visit_label
    - visit_description
    - visit_date
    - visit_timepoint
    - tags
    - identifier
  fullNodeView: true
  fullNodeViewForm:
    nameField:
      name: visit_label
    personFields:
    upperFields:
      - name: links
      - name: identifier
        label: Visit ID
      - name: visit_description
        label: Visit Description
      - name: tags
        label: Tags
    metadataFields:
      - name: visit_date
        label: Visit Date
      - name: visit_timepoint
        label: Visit Timepoint
    relationshipFields:
      - name: relationships
        label:
    bottomFields:
      - name: files
        label:

  fullNodeRegisterForm:
    readonlyFields:
      - identifier
    panels:
      - title: Overview
        fields:
          - name: visit_label
            label: Visit Label
            description: Number + Time Component + Date
          - name: visit_description
            label: Visit Description
            description: Description of the subject's visit, including treatment information and details pertaining to the purpose of the visit.

      - title: Details
        optional: true
        fields:
          - name: submitter_id
            label: Submitter ID
          - name: visit_date
            label: Visit Date
            description: Date of the visit.
          - name: visit_timepoint
            label: Visit Timepoint
            description: Timepoint that the visit corresponds to with respect to a sample taken from the subject or an experimental timeline.

      - title: Related Metadata
        optional: true
        fields:
          - name: relationships
            label:
          - name: tags
            label: Tags

      - title: Files
        fields:
          - name: files
            label:

  fullNodeEditForm:
    readonlyFields:
      - identifier
    panels:
      - title: Overview
        fields:
          - name: visit_label
            label: Visit Label
            description: Number + Time Component + Date
          - name: visit_description
            label: Visit Description
            description: Description of the subject's visit, including treatment information and details pertaining to the purpose of the visit.

      - title: Details
        optional: true
        fields:
          - name: submitter_id
            label: Submitter ID
          - name: visit_date
            label: Visit Date
            description: Date of the visit.
          - name: visit_timepoint
            label: Visit Timepoint
            description: Timepoint that the visit corresponds to with respect to a sample taken from the subject or an experimental timeline.

      - title: Related Metadata
        optional: true
        fields:
          - name: relationships
            label:
          - name: tags
            label: Tags

      - title: Files
        fields:
          - name: files
            label:


systemProperties:
  - id
  - _id
  - created_datetime
  - updated_datetime
  - created_by
  - submitter_id
  - type
  - state

required:
  - type

uniqueKeys:
  - [id]

# links:
#   - name: clinical_trial
#     backref: visit
#     parent_title: Clinical Trials # what's rendered for this node
#     child_title: Visits
#     label: is_part_of
#     target_type: clinical_trial
#     multiplicity: many_to_many
#     required: false

properties:
  $ref: "_definitions.yaml#/ubiquitous_properties"

  visit_label:
    title: Visit Label
    description: Number + Time Component + Date
    type: string
    placeholder: Input here

  visit_description:
    title: Visit Description
    description: Description of the subject's visit, including treatment information and details pertaining to the purpose of the visit.
    multiline: true
    type: string
    placeholder: Input here

  visit_date:
    title: Visit Date
    description: Date of the visit.
    placeholder: yyyy-mm-dd
    type: string
    format: date
    uiDateFormat: MM-DD-YYYY

  visit_timepoint:
    title: Visit Timepoint
    description: Timepoint that the visit corresponds to with respect to a sample taken from the subject or an experimental timeline.
    multiline: true
    placeholder: Input here
    type: array
    items:
      type: string

  clinical_trial:
    $ref: "_definitions.yaml#/to_many"